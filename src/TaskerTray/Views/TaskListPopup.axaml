<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Class="TaskerTray.Views.TaskListPopup"
        Title="Tasker"
        Width="400"
        Height="600"
        WindowStartupLocation="Manual"
        SystemDecorations="None"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        TransparencyLevelHint="Transparent"
        Background="Transparent"
        CanResize="False"
        ShowInTaskbar="False"
        ShowActivated="True"
        Topmost="True"
        Focusable="True">

    <Window.Styles>
        <!-- Popup content fade + slide animation -->
        <Style Selector="Border.popupContent">
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="RenderTransform" Value="translateY(-8px)"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.popupContent.visible">
            <Setter Property="Opacity" Value="1"/>
            <Setter Property="RenderTransform" Value="translateY(0)"/>
        </Style>

        <!-- Task item animations -->
        <Style Selector="Border.taskItem">
            <Setter Property="Opacity" Value="1"/>
            <Setter Property="RenderTransform" Value="translateY(0px)"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.taskItem.checked">
            <Setter Property="Opacity" Value="0.6"/>
        </Style>
        <Style Selector="Border.taskItem.entering">
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="RenderTransform" Value="translateY(-10px)"/>
        </Style>
        <Style Selector="Border.taskItem.exiting">
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="RenderTransform" Value="translateX(20px)"/>
        </Style>
        <Style Selector="Border.taskItem:pointerover">
            <Setter Property="Background" Value="#333333"/>
        </Style>

        <!-- Dragging state -->
        <Style Selector="Border.taskItem.dragging">
            <Setter Property="Opacity" Value="0.95"/>
            <Setter Property="Background" Value="#3A3A3A"/>
            <Setter Property="ZIndex" Value="100"/>
            <Setter Property="BoxShadow" Value="0 8 24 0 #40000000"/>
        </Style>

        <!-- List header base styles -->
        <Style Selector="Border.listHeader">
            <Setter Property="RenderTransform" Value="translateY(0px)"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.listHeader:pointerover">
            <Setter Property="Background" Value="#2A2A2A"/>
        </Style>

        <Style Selector="Border.listHeader.dragging">
            <Setter Property="Opacity" Value="0.95"/>
            <Setter Property="Background" Value="#3A3A3A"/>
            <Setter Property="ZIndex" Value="100"/>
            <Setter Property="BoxShadow" Value="0 8 24 0 #40000000"/>
        </Style>

        <!-- List section collapse/expand -->
        <Style Selector="StackPanel.listTasks">
            <Setter Property="MaxHeight" Value="2000"/>
            <Setter Property="Opacity" Value="1"/>
            <Setter Property="RenderTransform" Value="translateY(0)"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="MaxHeight" Duration="0:0:0.2" Easing="CubicEaseInOut"/>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="StackPanel.listTasks.collapsed">
            <Setter Property="MaxHeight" Value="0"/>
            <Setter Property="Opacity" Value="0"/>
        </Style>

        <!-- Chevron rotation animation -->
        <Style Selector="Button.chevron">
            <Setter Property="RenderTransform" Value="rotate(0deg)"/>
            <Setter Property="RenderTransformOrigin" Value="50%, 50%"/>
            <Setter Property="Transitions">
                <Transitions>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.2" Easing="CubicEaseInOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Button.chevron.collapsed">
            <Setter Property="RenderTransform" Value="rotate(-90deg)"/>
        </Style>

        <!-- Inline input field fade-in -->
        <Style Selector="Border.inlineInput">
            <Setter Property="Opacity" Value="1"/>
            <Setter Property="RenderTransform" Value="translateY(0)"/>
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                    <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.15" Easing="CubicEaseOut"/>
                </Transitions>
            </Setter>
        </Style>
        <Style Selector="Border.inlineInput.entering">
            <Setter Property="Opacity" Value="0"/>
            <Setter Property="RenderTransform" Value="translateY(-8px)"/>
        </Style>
    </Window.Styles>

    <Border x:Name="PopupContent"
            Classes="popupContent"
            CornerRadius="14"
            Background="#202020"
            BorderBrush="#404040"
            BorderThickness="1"
            Padding="0">

        <Grid RowDefinitions="Auto,Auto,*,Auto">
            <!-- Header -->
            <Border Grid.Row="0"
                    Background="#303030"
                    CornerRadius="14,14,0,0"
                    Padding="12,10">
                <Grid ColumnDefinitions="*,Auto,Auto">
                    <TextBlock Text="Tasker"
                               FontWeight="SemiBold"
                               FontSize="14"
                               Foreground="White"
                               VerticalAlignment="Center"/>
                    <Button Grid.Column="1"
                            x:Name="ListFilterButton"
                            FontSize="12"
                            Padding="10,6"
                            CornerRadius="10"
                            Click="OnListFilterClick">
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <TextBlock x:Name="ListFilterText" Text="All Lists" VerticalAlignment="Center"/>
                            <TextBlock Text="â–¾" FontSize="9" VerticalAlignment="Center" Foreground="#888"/>
                        </StackPanel>
                    </Button>
                    <Button Grid.Column="2"
                            x:Name="CreateListButton"
                            Content="+"
                            Width="28"
                            Height="28"
                            FontSize="16"
                            Padding="0"
                            Margin="6,0,0,0"
                            Background="Transparent"
                            Foreground="#888"
                            CornerRadius="6"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            ToolTip.Tip="Create new list"
                            Click="OnCreateListClick"/>
                </Grid>
            </Border>

            <!-- Search -->
            <Border Grid.Row="1" Background="#2A2A2A" Padding="12,6">
                <TextBox x:Name="SearchTextBox"
                         Watermark="Search all tasks..."
                         Background="Transparent"
                         BorderThickness="0"
                         FontSize="13"
                         Foreground="White"/>
            </Border>

            <!-- Task List - built programmatically for grouping support -->
            <ScrollViewer Grid.Row="2"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel x:Name="TaskListPanel" Margin="8" Spacing="4"/>
            </ScrollViewer>

            <!-- Footer -->
            <Border Grid.Row="3"
                    Background="#252525"
                    CornerRadius="0,0,14,14"
                    Padding="12,8">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock x:Name="StatusText"
                               Text=""
                               FontSize="11"
                               Foreground="#888"
                               VerticalAlignment="Center"/>
                    <Button Grid.Column="1"
                            Content="Quit"
                            Click="OnQuit"
                            FontSize="10"
                            Padding="8,4"
                            Background="Transparent"
                            Foreground="#666"
                            CornerRadius="4"/>
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
